{% comment %}
  sections/main-product.liquid
  Product page with vertical layout - Updated features to match pricing
{% endcomment %}

{% assign is_setup_product = false %}
{% if product.handle == 'bot-suite-setup' or product.handle == 'trading-bot-suite-setup' or product.handle contains 'setup-fee' or product.handle == 'professional-setup' %}
  {% assign is_setup_product = true %}
{% endif %}

<section class="product-page {% if is_setup_product %}setup-product-page{% endif %}" data-product-handle="{{ product.handle }}">
  <div class="container">
    <div class="product-grid">
      <!-- Product Info -->
      <div class="product-info">
        {% if is_setup_product %}
          <span class="optional-badge">Optional Add-On</span>
        {% endif %}
        
        <h1 class="product-title">{{ product.title }}</h1>
        
        <div class="product-price">
          <span class="price">{{ product.selected_or_first_available_variant.price | money }}</span>
          {% if is_setup_product %}
            <span class="period">one-time</span>
          {% else %}
            <span class="period">/mo</span>
          {% endif %}
          {% if product.compare_at_price > product.price %}
            <span class="compare-price">{{ product.compare_at_price | money }}</span>
          {% endif %}
        </div>

        <!-- Automation Requirements Notice (for ALL products) -->
        <div class="automation-notice">
          <p><strong>Note:</strong> Full automation requires a third-party subscription and may require a higher-tier TradingView plan</p>
        </div>

        <!-- Setup Fee Info (for bot products only, NOT for setup product itself) -->
        {% if product.handle == 'trading-bot-suite-49' or product.handle == 'trading-bot-suite-490-annual' %}
          <div class="setup-fee-info">
            <p><strong>Optional:</strong> Setup Service available separately for <strong>$249</strong> one-time</p>
            <a href="/#pricing" class="view-setup-link">View Setup Service →</a>
          </div>
        {% endif %}

        {% if product.description != blank %}
          <div class="product-description">
            <h3>What's Included:</h3>
            {{ product.description }}
          </div>
        {% else %}
          <div class="product-description">
            <h3>What's Included:</h3>
            <ul class="feature-list">
              {% if is_setup_product %}
                <li>✓ Complete Automation Setup</li>
                <li>✓ TradingView Integration</li>
                <li>✓ Strategy Configuration</li>
                <li>✓ Alert Setup & Testing</li>
                <li>✓ 1-on-1 Setup Support</li>
              {% else %}
                <li>✓ Proven Trading Strategies</li>
                <li>✓ Sharp Shooter Candles 4.2</li>
                <li>✓ Sharp Shooter RSI 2.0</li>
                <li>✓ Automation-Ready Strategies</li>
                <li>✓ Private Discord Community</li>
                <li>✓ Priority Support</li>
              {% endif %}
            </ul>
          </div>
        {% endif %}
      </div>

      <!-- Form Section -->
      <div class="product-form-section">
        <!-- Plan Selector for Bot Suite Products (not for setup fee) -->
        {% if product.handle == 'trading-bot-suite-49' or product.handle == 'trading-bot-suite-490-annual' %}
          <div class="plan-selector">
            <label>Choose Your Plan:</label>
            <div class="plan-options">
              <div class="plan-option monthly-option">
                <input type="radio" name="plan_choice" id="monthly-plan" value="monthly" 
                  {% if product.handle == 'trading-bot-suite-49' %}checked{% endif %}>
                <label for="monthly-plan">
                  <strong>Monthly</strong>
                  <span class="plan-price">$49/mo</span>
                </label>
              </div>
              <div class="plan-option annual-option">
                <input type="radio" name="plan_choice" id="annual-plan" value="annual"
                  {% if product.handle == 'trading-bot-suite-490-annual' %}checked{% endif %}>
                <label for="annual-plan">
                  <strong>Annual</strong>
                  <span class="plan-price">$490/yr</span>
                  <span class="plan-savings">Save $98</span>
                </label>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Product Form -->
        {% form 'product', product, id: 'product-form' %}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="variant-id">
          
          <!-- Hidden selling plan (auto-select first one if exists) -->
          {% if product.selling_plan_groups.size > 0 %}
            {% for selling_plan_group in product.selling_plan_groups %}
              {% for selling_plan in selling_plan_group.selling_plans %}
                {% if forloop.first %}
                  <input type="hidden" name="selling_plan" value="{{ selling_plan.id }}">
                {% endif %}
              {% endfor %}
            {% endfor %}
          {% endif %}
          
          <!-- Hidden quantity, always 1 -->
          <input type="hidden" name="quantity" value="1">

          <!-- Add to Cart Button -->
          <button type="submit" name="add" class="add-to-cart-btn" id="add-to-cart">
            <span class="btn-text">{% if is_setup_product %}Add Setup{% else %}Add to Cart{% endif %}</span>
          </button>

          <div id="cart-message" class="cart-message" style="display: none;"></div>
        {% endform %}
      </div>
    </div>
  </div>
</section>

<script src="{{ 'product.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Product Information",
  "settings": []
}
{% endschema %}