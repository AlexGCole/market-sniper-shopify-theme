<section id="pricing" class="pricing">
  <div class="container">
    <div class="section-header">
      <h2>{{ section.settings.section_title }}</h2>
      <p>{{ section.settings.section_subtitle }}</p>
    </div>
    
    <div class="pricing-wrapper">
      {% for block in section.blocks %}
        {% if block.type == 'pricing_header' %}
          <div class="pricing-category-header">
            <h3>{{ block.settings.header_text }}</h3>
          </div>
        {% elsif block.type == 'pricing_plan' %}
          <div class="pricing-card {% if block.settings.featured %}featured{% endif %}">
            {% if block.settings.featured %}
              <div class="popular-badge">{{ block.settings.badge_text }}</div>
            {% endif %}
            
            <div class="pricing-header">
              <h3>{{ block.settings.plan_name }}</h3>
              <div class="price">
                <span class="currency">$</span>
                <span class="amount">{{ block.settings.price }}</span>
                <span class="period">/{{ block.settings.period }}</span>
              </div>
              {% if block.settings.savings_text != blank %}
                <div class="savings">{{ block.settings.savings_text }}</div>
              {% endif %}
            </div>
            
            <ul class="pricing-features">
              {% assign features = block.settings.features | newline_to_br | split: '<br />' %}
              {% for feature in features %}
                {% if feature != blank %}
                  <li>{{ feature }}</li>
                {% endif %}
              {% endfor %}
            </ul>
            
            {% if block.settings.product != blank %}
              {% assign selected_product = all_products[block.settings.product] %}
              {% if selected_product != blank %}
                <div class="pricing-checkout">
                  {% form 'product', selected_product, class: 'pricing-form' %}
                    <input type="hidden" name="id" value="{{ selected_product.selected_or_first_available_variant.id }}">
                    <button type="submit" name="add" class="btn {% if block.settings.featured %}btn-primary{% else %}btn-outline{% endif %}">
                      {{ block.settings.button_text }}
                    </button>
                  {% endform %}
                </div>
              {% endif %}
            {% else %}
              <a href="{{ block.settings.button_link }}" class="btn {% if block.settings.featured %}btn-primary{% else %}btn-outline{% endif %}">
                {{ block.settings.button_text }}
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .pricing-wrapper {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 320px));
    justify-content: center;
    gap: var(--spacing-xl);
    max-width: 1200px;
    margin: 0 auto;
  }

  .pricing-category-header {
    grid-column: 1 / -1;
    text-align: center;
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-lg);
    padding-top: var(--spacing-2xl);
    border-top: 1px solid rgba(0, 255, 65, 0.2);
  }

  .pricing-category-header:first-child {
    margin-top: 0;
    padding-top: 0;
    border-top: none;
  }

  .pricing-category-header h3 {
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--light);
    margin-bottom: var(--spacing-xs);
  }

  .pricing-checkout {
    margin-top: auto;
  }

  .pricing-form {
    width: 100%;
  }

  .pricing-form .btn {
    width: 100%;
  }

  @media (max-width: 1024px) {
    .pricing-wrapper {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .pricing-wrapper {
      grid-template-columns: 1fr;
    }
    
    .pricing-card.featured {
      transform: scale(1);
    }
  }
</style>

{% schema %}
{
  "name": "Pricing",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Choose Your Plan"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Flexible pricing options to match your trading needs"
    }
  ],
  "blocks": [
    {
      "type": "pricing_header",
      "name": "Category Header",
      "settings": [
        {
          "type": "text",
          "id": "header_text",
          "label": "Header Text",
          "default": "Plan Category"
        }
      ]
    },
    {
      "type": "pricing_plan",
      "name": "Pricing Plan",
      "settings": [
        {
          "type": "text",
          "id": "plan_name",
          "label": "Plan Name",
          "default": "Monthly"
        },
        {
          "type": "text",
          "id": "price",
          "label": "Price",
          "default": "79"
        },
        {
          "type": "select",
          "id": "period",
          "label": "Billing Period",
          "options": [
            { "value": "mo", "label": "Monthly" },
            { "value": "yr", "label": "Yearly" }
          ],
          "default": "mo"
        },
        {
          "type": "text",
          "id": "savings_text",
          "label": "Savings Text",
          "info": "e.g., 'Save 30%' or '$250 Setup Fee'"
        },
        {
          "type": "textarea",
          "id": "features",
          "label": "Features (one per line)",
          "default": "✓ Feature 1\n✓ Feature 2"
        },
        {
          "type": "checkbox",
          "id": "featured",
          "label": "Featured Plan",
          "default": false
        },
        {
          "type": "text",
          "id": "badge_text",
          "label": "Featured Badge Text",
          "default": "Most Popular"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Get Started"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link (fallback)",
          "info": "Used if no product is selected"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Pricing"
    }
  ]
}
{% endschema %}